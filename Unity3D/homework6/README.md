# 智能巡逻兵

- 提交要求：
  - 游戏设计要求：
    - 创建一个地图和若干巡逻兵(使用动画);
    - 每个巡逻兵走一个3~5个边的凸多边型，位置数据是相对地址。即每次确定下一个目标位置，用自己当前位置为原点计算;    - 
    - 巡逻兵碰撞到障碍物，则会自动选下一个点为目标；
    - 巡逻兵在设定范围内感知到玩家，会自动追击玩家；
    - 失去玩家目标后，继续巡逻；
    - 计分：玩家每次甩掉一个巡逻兵计一分，与巡逻兵碰撞游戏结束；
  - 程序设计要求：
    - 必须使用订阅与发布模式传消息
    - subject：OnLostGoal
    - Publisher: ?
    - Subscriber: ?
    - 工厂模式生产巡逻兵

## 类的结构

- MonoBehaviour的单例类
- 巡逻兵的MonoBehaviour类，与之关联的工厂类，方便设置和保存巡逻兵参数的可序列化类
- 专门处理事件处理逻辑的public static partial class GameEvents.cs
- SceneController
- 生成巡逻兵路径的类

## Step

### Prefab

- Collider来检测碰撞，若碰撞触发，则游戏结束。距离检测，当Player与巡逻兵在一定距离之内时，巡逻兵开始追逐Player。用内外两个Collider即可解决。内部为Collider碰撞器，外部为Trigger触发器。

### 巡逻兵

- 巡逻兵本体属性，isEnabled、速度、巡逻路线的顺序点集、是否已发现Player、Player的位置，以及三种情况下的回调函数声明。三种情况分别是：巡逻兵发现Player; 巡逻兵与Player相撞; 巡逻兵被Player甩开。

### 巡逻兵路径

- 3~5凸多边形的生成, 按照老师的方法 随机生成矩形，在矩形每个边上随机找点，可得到凸多边型, 大于4的多边形，可以使用在圆上随机取点 (未实现)。

### 工厂类和 SceneController

- 单例，运用以前知识

### 订阅与发布模式：事件产生 和 事件处理的代码的分离

- 巡逻兵是所有事件的感知和产生者。而对一个事件做出反应的东西往往有很多个。这种时候，将事件的感知和处理逻辑写在一起，是一种很难以维护的方式。对于这个游戏来说，事件逻辑已经足够简单，所以发布者和订阅者都可以简化成一个：发布者是每个巡逻兵，订阅者是SceneController。
- 比较典型一点的构造应当是：多个订阅者拥有自己的对同一类事件的各自的事件处理逻辑，然后在每个订阅者实例化的时候，向一个专门负责事件发布与接收的地方注册自己的事件处理函数，发布者在感知并产生事件之后，向同样的负责事件分发的地方传送自己的事件，该事件依次进入不同订阅者的逻辑中，实施其自己的工作。
- 在群里看到一位师兄对观察者的讲解，受益颇深，观察者是为了分离组件的耦合，如果是本来就写在一起的功能就没必要用。如果是需要分开写方便维护的就用，例如成就系统，杀100只蝙蝠拿称号，你要是在角色身上写一个计数器然后到100去调用成就系统，这样子成就系统就分散在整个游戏里很难维护。你需要把绑定的过程写在成就系统里，让成就系统去绑角色，让角色知道杀掉怪物就通知一声自己杀了什么，其他的由成就系统处理，这个信息是谁用，怎么用都不需要角色知道。巡逻兵也是一样的，被抓到就输了，那就让角色被抓到时说一声，由游戏管理者来处理，而不是在角色身上写一大堆代码和手动绑定成就类。

[视频地址](https://youtu.be/CZFZky_vvWY)
